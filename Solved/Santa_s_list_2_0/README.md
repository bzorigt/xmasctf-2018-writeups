# Santa's list 2.0
Crypto

## Challenge 

	Santa's MechaGnomes caught up to some intense traffic on their servers so they decided to modify santa's database server to be DDoS-proof but it still is corrupted, find out if Galf was nice or not but try not to DDoS the server.

	Server: nc 199.247.6.180 16002 
	Author: SoulTaku

list_2.py

## Solution

Same as before, but it limits us to 5 queries now... we can try using our old method in [Santa's list](../../Solved/Santa_s_list) as we only did 4 queries!

### Concept

See my writeup for [Santa's list](../../Solved/Santa_s_list) to understand how it works.


### Solving

Ciphertext from server

	$ nc 199.247.6.180 16001
	Ho, ho, ho and welcome back!
	Your list for this year:

	Sarah - Nice
	Bob - Nice
	Eve - Naughty
	Galf - 6b9a66f54d60011c1aaf88acf2b3d8371e22a818e3fbbea635590a36733402456caf76bfb591c1b6dda6c5a6afb34fa238e45adc75a4f6e9ba1f97ae2a5035f1dd860fdb43cfd65ef7639b08237978413a4f28cb133d0662468c656616f5b57ce734ffc2e015cc958e026a8414998db164e4b8482fa6c258d2740e439e40f03d

Get multiplication items

	# ./yafu

	>> factor(0x6b9a66f54d60011c1aaf88acf2b3d8371e22a818e3fbbea635590a36733402456caf76bfb591c1b6dda6c5a6afb34fa238e45adc75a4f6e9ba1f97ae2a5035f1dd860fdb43cfd65ef7639b08237978413a4f28cb133d0662468c656616f5b57ce734ffc2e015cc958e026a8414998db164e4b8482fa6c258d2740e439e40f03d)

	***factors found***

	P3 = 659
	P11 = 64666364803

Choose 659

	>>> c = 0x6b9a66f54d60011c1aaf88acf2b3d8371e22a818e3fbbea635590a36733402456caf76bfb591c1b6dda6c5a6afb34fa238e45adc75a4f6e9ba1f97ae2a5035f1dd860fdb43cfd65ef7639b08237978413a4f28cb133d0662468c656616f5b57ce734ffc2e015cc958e026a8414998db164e4b8482fa6c258d2740e439e40f03d

	>>> c1 = 659

	>>> c2 = c // c1
	114660834606369920729233354905497493450657554015051437922102007712556355296345889199547285672441701243449514890365276851505964716065635756063175894135073456025227851594406167671428287897934582113227171012944550781172437025274690460198851078877129559915077616495044171903872374069398983565373149114030617583


Now decrypt both c1 and c2...

	Ciphertext > 114660834606369920729233354905497493450657554015051437922102007712556355296345889199547285672441701243449514890365276851505964716065635756063175894135073456025227851594406167671428287897934582113227171012944550781172437025274690460198851078877129559915077616495044171903872374069398983565373149114030617583

	Decrypted: 40028660523805081039463034459137196443902867888927326358981854552134770188499127998986304173190657776166038801846475148095585181866452937742678159360341178280762430963541556263993369091775493420474561836013922997172022463982560612343352579943903758050805582962201467570656691981219366927091001276267268685803

	---

	Ciphertext > 659

	Decrypted: 58855655113228361736908713643873382189276537590784744731982724605722366666560223946043765807496870890173837922092363048633165440677401993095228739544355403660993373653896851923473286621527529418183576300627630655362925637585527722515742727652419097636488826097614546443743903986902993821876395324564751626877


Then we need to find modulus, `N`.

	Plaintext > ^E

	Encrypted: 106165302109842731814462710983673636563410308430876244701410680414063195233811550986483089999875196729130562276754919675847384006926232713351932694500653164845081228821930862381984949973213243434586586930297358335934519367921110703922506869607138737412325692376407153542651297290410795539470837328686438624499

	---

	Plaintext > ^F

	Encrypted: 44007780331367142296917135904485177702940528562042902952204233672234557260447853381353686630568022648732097752104009798446376957291303398279260938166948259529476510289780407639920674160571605644931936012494820586324749021153266276643112186073115194686800104311934739186559900534938234115543569161782199118442


Finally put all into Python to calculate:

First, get the modulus N.

	>>> import gmpy2

	>>> r5 = 106165302109842731814462710983673636563410308430876244701410680414063195233811550986483089999875196729130562276754919675847384006926232713351932694500653164845081228821930862381984949973213243434586586930297358335934519367921110703922506869607138737412325692376407153542651297290410795539470837328686438624499
	>>> r6 = 44007780331367142296917135904485177702940528562042902952204233672234557260447853381353686630568022648732097752104009798446376957291303398279260938166948259529476510289780407639920674160571605644931936012494820586324749021153266276643112186073115194686800104311934739186559900534938234115543569161782199118442

	>>> N = gmpy2.gcd(pow(5,e) - r5, pow(6,e) - r6)

Next, calculate the message

	>>> M_p1 = 40028660523805081039463034459137196443902867888927326358981854552134770188499127998986304173190657776166038801846475148095585181866452937742678159360341178280762430963541556263993369091775493420474561836013922997172022463982560612343352579943903758050805582962201467570656691981219366927091001276267268685803
	>>> M_p2 = 58855655113228361736908713643873382189276537590784744731982724605722366666560223946043765807496870890173837922092363048633165440677401993095228739544355403660993373653896851923473286621527529418183576300627630655362925637585527722515742727652419097636488826097614546443743903986902993821876395324564751626877

	>>> M = (M_p1 * M_p2) % N
	>>> M
	mpz(53014360459548163466198452150566768945348129848316501509173374921240390376031513235156657474306965036205184860029)

	>>> bytes.fromhex( hex(M)[2:])
	b'X-MAS{n4ugh7y_dd0s_pr073c710n_1sn7_h4rd_r1gh7?}'

## Flag

	X-MAS{n4ugh7y_dd0s_pr073c710n_1sn7_h4rd_r1gh7?}
