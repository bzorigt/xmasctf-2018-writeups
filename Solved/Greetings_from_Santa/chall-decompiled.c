//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2018 Retargetable Decompiler <info@retdec.com>
//

#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

struct vtable_804888c_type {
    int32_t (*e0)(char *);
};

struct vtable_8048898_type {
    int32_t (*e0)(char *);
};

// ------------------------- Classes --------------------------

// CommandExecutor
// Greeter

// ------------------- Function Prototypes --------------------

int32_t entry_point(int32_t a1);
int32_t function_8048460(void);
char * function_80484a0(char * s, int32_t n, struct _IO_FILE * stream);
int32_t function_80484b0(struct _IO_FILE * stream, char * buf, int32_t modes, int32_t n);
int32_t function_80484c0(char * s);
int32_t function_80484d0(int32_t seconds);
int32_t function_80484e0(int32_t main, int32_t argc, char ** ubp_av, void (*init)(), void (*fini)(), void (*rtld_fini)());
int32_t function_80484f0(char * format, ...);
int32_t function_8048500(char * command);
int32_t function_8048510(void);
int32_t function_8048553(int32_t a1, int32_t a2, int32_t a3);
int32_t function_8048560(void);
int32_t function_8048570(int32_t a1);
int32_t function_8048580(int32_t a1);
int32_t function_80485b1(void);
int32_t function_80485c0(int32_t a1);
int32_t function_8048602(void);
int32_t function_8048632(void);
int32_t function_8048636(int32_t a1);
int32_t function_8048703(int32_t * a1);
int32_t function_8048760(void);
int32_t function_8048772(char * command);
int32_t function_804878a(char * a1);
int32_t function_80487b0(int32_t a1);
int32_t function_8048810(void);
int32_t function_8048814(void);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // eax
int32_t g2 = 0; // ebp
int32_t g3 = 0; // ebx
struct _IO_FILE * g6 = NULL;
struct _IO_FILE * g7 = NULL;
int32_t g8 = 0;
char g9 = 0;
struct vtable_804888c_type g4 = {
    .e0 = function_804878a
};
struct vtable_8048898_type g5 = {
    .e0 = function_8048772
};

// ------------------------ Functions -------------------------

// Address range: 0x8048460 - 0x8048483
int32_t function_8048460(void) {
    int32_t v1 = g3; // 0x8048460
    function_8048570(v1);
    int32_t result; // 0x8048482
    if (*(int32_t *)(g3 + 0x1b93) != 0) {
        // 0x8048479
        result = function_8048510();
        // branch -> 0x804847e
    } else {
        result = 0;
    }
    // 0x804847e
    g3 = v1;
    return result;
}

// Address range: 0x80484a0 - 0x80484a6
char * function_80484a0(char * s, int32_t n, struct _IO_FILE * stream) {
    // 0x80484a0
    return fgets(s, n, stream);
}

// Address range: 0x80484b0 - 0x80484b6
int32_t function_80484b0(struct _IO_FILE * stream, char * buf, int32_t modes, int32_t n) {
    // 0x80484b0
    return setvbuf(stream, buf, modes, n);
}

// Address range: 0x80484c0 - 0x80484c6
int32_t function_80484c0(char * s) {
    // 0x80484c0
    return strlen(s);
}

// Address range: 0x80484d0 - 0x80484d6
int32_t function_80484d0(int32_t seconds) {
    // 0x80484d0
    return alarm(seconds);
}

// Address range: 0x80484e0 - 0x80484e6
int32_t function_80484e0(int32_t main, int32_t argc, char ** ubp_av, void (*init)(), void (*fini)(), void (*rtld_fini)()) {
    // 0x80484e0
    return __libc_start_main(main, argc, ubp_av, init, fini, rtld_fini);
}

// Address range: 0x80484f0 - 0x80484f6
int32_t function_80484f0(char * format, ...) {
    // 0x80484f0
    return printf(format);
}

// Address range: 0x8048500 - 0x8048506
int32_t function_8048500(char * command) {
    // 0x8048500
    return system(command);
}

// Address range: 0x8048510 - 0x8048516
int32_t function_8048510(void) {
    // 0x8048510
    return __gmon_start__();
}

// Address range: 0x8048520 - 0x8048553
int32_t entry_point(int32_t a1) {
    int32_t v1 = g1; // bp-4
    int32_t v2 = 0; // edx
    function_8048553(v2, (int32_t)&v1, g1);
    int32_t v3 = 0;
    __libc_start_main(0x8048636, a1, (char **)&v3, (void (*)())(g3 + 640), (void (*)())(g3 + 736), (void (*)())v2);
    // UNREACHABLE
}

// Address range: 0x8048553 - 0x8048557
int32_t function_8048553(int32_t a1, int32_t a2, int32_t a3) {
    // 0x8048553
    g3 = a1;
    return g1;
}

// Address range: 0x8048560 - 0x8048561
int32_t function_8048560(void) {
    // 0x8048560
    return 0;
}

// Address range: 0x8048570 - 0x8048574
int32_t function_8048570(int32_t a1) {
    // 0x8048570
    g3 = a1;
    return g1;
}

// Address range: 0x8048580 - 0x80485b1
int32_t function_8048580(int32_t a1) {
    // 0x8048580
    return 0x804a030;
}

// Address range: 0x80485b1 - 0x80485b3
int32_t function_80485b1(void) {
    // 0x80485b1
    int32_t * v1;
    return function_80485c0((int32_t)&v1);
}

// Address range: 0x80485c0 - 0x80485f9
int32_t function_80485c0(int32_t a1) {
    // 0x80485c0
    return 0;
}

// Address range: 0x8048602 - 0x8048629
int32_t function_8048602(void) {
    // 0x8048602
    if (g9 != 0) {
        // 0x8048628
        return 0;
    }
    // 0x804860d
    g9 = 1;
    return function_8048580((int32_t)0);
}

// Address range: 0x8048632 - 0x8048636
int32_t function_8048632(void) {
    // 0x8048632
    return function_80485c0((int32_t)0);
}

// Address range: 0x8048636 - 0x8048703
// From class:    Greeter
// Type:          constructor
int32_t function_8048636(int32_t a1) {
    // 0x8048636
    alarm(60);
    setvbuf(g6, NULL, 2, 0);
    setvbuf(g7, NULL, 2, 0);
    setvbuf((struct _IO_FILE *)g8, NULL, 2, 0);
    int32_t v1 = (int32_t)&g4; // bp-20
    printf("Greetings from Santa! Wanna talk? ");
    function_8048760();
    int32_t str = 0; // bp-84
    fgets((char *)&str, 512, g7);
    int32_t result;
    if (str % 256 == 121) {
        // 0x80486e0
        function_8048703(&v1);
        result = 0;
        // branch -> 0x80486fb
    } else {
        result = 1;
    }
    // 0x80486fb
    return result;
}

// Address range: 0x8048703 - 0x8048760
int32_t function_8048703(int32_t * a1) {
    // 0x8048703
    printf("What is your name? ");
    int32_t str = 0; // bp-112
    fgets((char *)&str, 100, g7);
    *(char *)(strlen((char *)&str) - 109 + g2) = 0;
    return *(int32_t *)*a1;
}

// Address range: 0x8048760 - 0x8048771
// From class:    CommandExecutor
// Type:          constructor
int32_t function_8048760(void) {
    // 0x8048760
    return (int32_t)&g5;
}

// Address range: 0x8048772 - 0x8048789
// From class:    CommandExecutor
// Type:          virtual member function
int32_t function_8048772(char * command) {
    // 0x8048772
    return system(command);
}

// Address range: 0x804878a - 0x80487a6
// From class:    Greeter
// Type:          virtual member function
int32_t function_804878a(char * a1) {
    // 0x804878a
    return printf("Hohoho! Hello, %s!\n", a1);
}

// Address range: 0x80487b0 - 0x8048805
int32_t function_80487b0(int32_t a1) {
    int32_t v1 = 0; // esp
    g1 = function_8048570(0);
    g3 += 0x1847;
    function_8048460();
    *(int32_t *)(v1 - 8) = a1;
    *(int32_t *)(v1 - 12) = *(int32_t *)(v1 + 36);
    *(int32_t *)(v1 - 16) = *(int32_t *)(v1 + 32);
    int32_t v2 = 1; // 0x80487f3
    // branch -> 0x80487e0
    while (1 != v2) {
        // 0x80487e0
        *(int32_t *)(v1 - 8) = a1;
        *(int32_t *)(v1 - 12) = *(int32_t *)(v1 + 36);
        *(int32_t *)(v1 - 16) = *(int32_t *)(v1 + 32);
        v2++;
        // continue -> 0x80487e0
    }
    // 0x80487fd
    return g3 - 312;
}

// Address range: 0x8048810 - 0x8048811
int32_t function_8048810(void) {
    // 0x8048810
    return 0;
}

// Address range: 0x8048814 - 0x8048828
int32_t function_8048814(void) {
    // 0x8048814
    return function_8048570(0);
}

// --------------- Dynamically Linked Functions ---------------

// int32_t __gmon_start__(void);
// int __libc_start_main(int *(main)(int, char **, char **), int argc, char ** ubp_av, void(* init)(void), void(* fini)(void), void(* rtld_fini)(void), void(* stack_end));
// unsigned int alarm(unsigned int seconds);
// char * fgets(char * restrict s, int n, FILE * restrict stream);
// int printf(const char * restrict format, ...);
// int setvbuf(FILE * restrict stream, char * restrict buf, int modes, size_t n);
// size_t strlen(const char * s);
// int system(const char * command);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (8.0.1)
// Detected language: C++
// Detected functions: 26
// Decompilation date: 2018-12-19 09:45:50
